<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>B_Booking-搜搜</title>
<link rel="stylesheet" th:href="@{/css/bootstrap.min.css}" />
<link rel="stylesheet" th:href="@{/font-awesome/css/font-awesome.css}" />
<link th:href="@{/css/whir_common.css}" rel="stylesheet" type="text/css" />
<link th:href="@{/css/whir_style.css}" rel="stylesheet" type="text/css" />
<link th:href="@{/css/jquery.datetimepicker.css}" rel="stylesheet" type="text/css" />

<style type="text/css">
		    
            .front{width: 90%;margin: 5px 32px 45px 32px;background-color: #f0f0f0;	color: #666;text-align: center;padding: 3px;border-radius: 5px;}
			#seat_area{
			   width:80%;
			}
            .booking_area {float: right;position: relative;width:200px;height: 450px; }
            .booking_area h3 {margin: 5px 5px 0 0;font-size: 16px;}
            .booking_area p{line-height:26px; font-size:16px; color:#999}
            .booking_area p span{color:#666}
            div.seatCharts-cell {color: #182C4E;height: 25px;width: 25px;line-height: 25px;margin: 3px;float: left;text-align: center;outline: none;font-size: 13px;}
            div.seatCharts-seat {color: #fff;cursor: pointer;-webkit-border-radius: 5px;-moz-border-radius: 5px;border-radius: 5px;}
            div.seatCharts-row {height: 35px;width:890px;}
            div.seatCharts-seat.available {background-color: #B9DEA0;}
            div.seatCharts-seat.focused {background-color: #76B474;border: none;}
            div.seatCharts-seat.selected {background-color: #E6CAC4;}
            div.seatCharts-seat.unavailable {background-color: #472B34;cursor: not-allowed;}
            div.seatCharts-container {border-right: 1px dotted #adadad;width: 400px;padding: 20px;float: left;}
            div.seatCharts-legend {padding-left: 0px;position: absolute;bottom: 16px;}
            ul.seatCharts-legendList {padding-left: 0px;}
            .seatCharts-legendItem{float:left; width:90px;margin-top: 10px;line-height: 2;}
            span.seatCharts-legendDescription {margin-left: 5px;line-height: 30px;}
            .checkout-button {display: block;width:80px; height:24px; line-height:20px;margin: 10px auto;border:1px solid #999;font-size: 14px; cursor:pointer}
            #seats_chose {max-height: 150px;overflow-y: auto;overflow-x: none;width: 200px;}
            #seats_chose li{float:left; width:72px; height:26px; line-height:26px; border:1px solid #d3d3d3; background:#f7f7f7; margin:6px; font-size:14px; font-weight:bold; text-align:center}
           
            .modal-content{ 
               position: relative;
               left:-50%;
               width:1300px;
               height:700px;
                z-index:10000;
            }
            .container{
              float:left;
            }
            .seatCharts-container{
              
              height:663px;
            }
</style>
<script src="http://www.jq22.com/jquery/1.9.1/jquery.min.js"></script>
<!-- <script type="text/javascript" th:src="@{/js/jquery-1.11.2.min.js}"></script> -->
<!-- <script type="text/javascript" th:src="@{/js/jquery-1.7.2.min.js}"></script>  -->
<script type="text/javascript" th:src="@{/js/jquery.datetimepicker.full.min.js}"></script> 
</head>
<body class="body">

<!--头部-->
<div id="header">
  <div class="top">
    <div class="topmain">
      <div class="searchbox">
        <div class="so_so">
          <div class="logo"><a href="#" title="目课网"><img th:src="@{/images/logo.jpg}"  width="230px"  height="100px"></a></div>
          <div class="mk_so">
            <input type="text" class="input"  name=""/>
            <input type="image" th:src="@{/images/btn.jpg}"  class="btn" />
          </div>
        </div>
        <div class="topmenu">
          <div class="xsyd"><li class="li5"><a href="#">小店入驻</a></li></div>
          <div class="hylist">
            <ul>
              <li class="li1"><a href="myself">admin</a></li>
              <li class="li2"><a href="javascript:void(0);" onclick="showA();">注册</a>/<a href="javascript:void(0);" onclick="showB();">登陆</a></li>
              <li class="li3"><a href="#">小程序</a></li>
              <li class="li4"><a href="#">联系我们</a></li>
            </ul>
          </div>
		  				  <!--注册登录隐藏--->
	  <div id="pop" class="pop" style="display:none"> 
<div class="pop_head"><a href="javascript:void(0);" onclick="hideA()">关闭</a></div> 
<div class="pop_body">
<h1>用户注册</h1>
<div class="zhuce">
<input type="text" class="inputl" value="请输入真实邮箱" onFocus="this.value='';" onBlur="if(this.value==''){this.value='请输入真实邮箱';}" />
<input type="text" class="inputr" value="请输入用户名" onFocus="this.value='';" onBlur="if(this.value==''){this.value='请输入用户名';}" />
<input type="password" class="inputb" value="请输入密码" onFocus="this.value='';" onBlur="if(this.value==''){this.value='请输入密码';}" />
<div class="dlk"><a href="#" class="regist">注册</a><a href="#" class="login">返回登录</a></div>
</div>
</div> 
</div> 

<div id="pop1" class="pop1" style="display:none"> 
<div class="pop_head1"><a href="javascript:void(expression);" onclick="hideB()">关闭</a></div> 
<div class="pop_body1">
<h1>用户登陆</h1>
<div class="zhuce">
<input type="text" class="inputr" value="请输入用户名"  onFocus="this.value='';" onBlur="if(this.value==''){this.value='请输入用户名';}"/>
<input type="password" class="inputb" value="请输入密码" onFocus="this.value='';" onBlur="if(this.value==''){this.value='请输入密码';}" />
<div class="dlk"><a href="#" class="regist">登陆</a><a href="#" class="login">注册</a></div>
</div>
</div> 
</div>

        </div>
      </div>
      <!--菜单导航-->
      <div class="topnavmenu">
        <div class="nav">
          <ul>
            <li><a href="index" class="on">首页</a></li>
            <li><a href="ss">新店特惠</a></li>
			<li><a href="ss">附件好券</a></li>
            <li><a href="ss">自助餐</a></li>
            <li><a href="ss">火锅</a></li>
            <li><a href="ss">小吃快餐</a></li>
            <li><a href="ss">甜点饮品</a></li>
			<li><a href="ss">预约订座</a></li>
          </ul>
        </div>
        
      </div>
    </div>
  </div>
</div>
<div class="clear"></div>
<!--container-->
<div id="container">
<div class="left958">
<div class="kssearch12">
        <input type="hidden"  th:value="${shop.id}" id="shop_id"/>
        <img th:src="@{/pic/pic1.jpg}"  />
        <input type="hidden" id="shop_address"  th:value="${shop.address}"/>
		<div class="shop" >
			  <h1  th:text="'小店：'+${shop.name}"></h1>
              <h1  th:text="'地址：'+${shop.address}"></h1>
              <h1  th:text="'简介：'+${shop.introduction}"></h1>
              <h1  th:text="'电话：'+${shop.phone}"></h1>
			  <h1><a href="">查看评论(6)</a></h1>
			  <h1><a href="">距离</a></h1><br>
			  <h2><span >
			      <input type="button" onclick="selectroute();" value="路线"  style="width:90px;height:45px;color:#fff;background-color:#3db1ea;" />
			      <input type="button" onclick="openss();" value="预约"  style="width:90px;height:45px;color:#fff;background-color:#3db1ea;" />
			  </span></h2>
			 
		</div>
</div>
<div class="kssearch1">
		<div class="address">
		<h1>菜品</h1>
			 <h2  id="menuList">
					<!-- 内容 -->
			 </h2>
		</div>

</div>
<div class="kssearchbox1">
<span class="sspx">排序</span>
<!-- <div class="SelectBox">
 
 <span class="SelectText"></span>
 <dl class="SelectList">
     <dt><a href="javascript:void(0)">价格</a></dt>
 </dl>
</div>  -->



<div class="wdss"><input type="text" class="input1" /><input type="image" th:src="@{/images/search.jpg}"  class="btn1"/></div>
<span class="ssjg"  id="dishesListlength">共0个筛选结果</span><div class="page1"><span class="num"><font class="f_blue">1</font>/41</span><span class="prev">上一页</span><span class="next"><a href="#">下一页</a></span> </div>
</div>

        
        <div class="splist"  id="dishesList">
          <!-- 内容 -->  
      </div>
	  <div class="page"><span class="prev">上一页</span><span class="num"><a href="#" class="on">1</a><a href="#">2</a><a href="#">3</a><a href="#">4</a><a href="#">5</a><a href="#">6</a><a href="#">7</a><a href="#">8</a><a href="#">9</a><a href="#">10</a></span><span class="next"><a href="#">下一页</a></span><em>217/5</em>转到
        <input name="textfield" type="text" value="5" class="inputpage"/>
        页
        <input type="submit" name="Submit" value="GO" class="btngo"/>
      </div>
</div>
<div class="right213">
<div class="title"><h1>推荐菜品</h1></div>
<div class="likelist"  id="RecommenddishesList">
       <!-- 内容 -->
      </div>
</div>
</div>

<!-- 选座弹框 -->
<div class="modal fade" id="openseat" tabindex="-1" role="dialog" aria-labelledby="addroleLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content" >
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="addroleLabel">座位列表</h4>
            </div>
            <div class="modal-body">
            
            
                <div class="widget-box">
         
                <div class="widget-content nopadding">
                    <table class="table table-bordered data-table" id="datatable" >
		               <div class="container">			        
				            <div class="demo clearfix">
				                <!---左边座位列表----->
				                <div id="seat_area">
				                    <div class="front">正门</div>					
				                </div>
				                <!---右边选座信息----->
				                <div class="booking_area">
				                    <!-- <p>餐厅：<span>美食城</span></p>
				                    <p>时间：<span>2018年08月16日 22:15</span></p> -->
				                    <p>起始时间：<span><input type="text" value=""  id="datetimepicker1" data-date-format="yyyy-mm-dd hh:ii">           
				                    </span></p>
				                    <p>结束时间：<span><input type="text" value=""  id="datetimepicker2" data-date-format="yyyy-mm-dd hh:ii">           
				                    </span></p>
				                    <p>座位：</p>
				                    <ul id="seats_chose">
				
				                    </ul>
				                    <!-- <p>票数：<span id="tickects_num">0</span></p>
				                    <p>总价：<b>￥<span id="total_price">0</span></b></p> -->
				                    <input type="button" class="bookingbtnbug" value="预约" style="width:90px;height:45px;color:#fff;background-color:#3db1ea;"/>
				                    <script >
				                         $('#datetimepicker1').datetimepicker();
				                         $('#datetimepicker2').datetimepicker();  
				                    </script> 
				                    <div id="legend"></div>
				                </div>
				            </div>
			           </div>
                    </table>
                </div>
            </div>

            </div>
        </div>
    </div>
</div>
<!--end-Footer-part-->
<!-- <script src="http://www.jq22.com/jquery/1.9.1/jquery.min.js"></script> -->
<script th:src="@{/js/bootstrap.min.js}"></script>
<!-- <script type="text/javascript" th:src="@{/js/jquery-1.11.2.min.js}"></script> -->
<script th:src="@{/js/layer.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.seat-charts.min.js}"></script>

<script type="text/javascript">
	function selectroute(){
		var endname =document.getElementById("shop_address").value;
		//window.location.href="/seat/toroute?endname="+endname;
		window.open('/seat/toroute?endname='+endname);
	}
    function openss(){

    	$('#openseat').modal();
    }

</script>
<script type="text/javascript">
            var price = 100; //电影票价
            var mycars=new Array()
			var selects=new Array()
            var unavaliable=new Array();
            var arr=new Array();             //声明一维数组        
            for(var x=1;x<15;x++){
                  arr[x]=new Array();        //声明二维数组
                  for(var y=1;y<28;y++){
                       arr[x][y]='_';          //数组初始化为0
                  }
            }
            $.ajax({
                async:false,
                type : "get",
                data:{cell:1},
                url: "/seat/getAllSeat",
                dataType:'json',
                success: function(data){
                	if(data!=null){
                		var seats_chose = document.getElementById("seats_chose");

                		for(var k=0;k<data.length;k++){
                			
                			//console.log(data[k]);
                			
                			var str = data[k].name.split("_");
                		    arr[str[0]][str[1]]='c';
                		    if(data[k].start!=null & data[k].start!=""){
                		    	unavaliable.push(data[k].name);
                		    }
                			/*
                			seat_List.push(data[k].name);
                			$('<li>' + data[k].name + '</li>')
                            .attr('id', 'cart-item-' + data[k].name)
                            .data('seatId', data[k].name)
                            .appendTo($cart);

                			sc.get([data[k].name]).status('selected');
                			*/
                		}
                	} 
                }
            });
             for(var x=1;x<15;x++){
                //arr[x]=new Array();        //声明二维数组
                var textt="";
                for(var y=1;y<15;y++){
                	textt+=arr[x][y];          //数组初始化为0
                } 
                mycars[x]=textt;
            }
            
            ///for(var k=0;k<14;k++){
			//    mycars[k]='"ccccccccccccccccccccccccccc"';
			//}
			//mycars[5]='"cccccccccccccccccccccc_cccc"';
			 
			text_map=[]
			for(var k=1;k<15;k++){
			    if(k==mycars.length-1){
				   text_map.push(mycars[k]);
				}else{
				   text_map.push(mycars[k]);
				}  
			}
			seat_List=[];

			$(document).ready(function() {
				
                var $cart = $('#seats_chose'), //座位区
                     $tickects_num = $('#tickects_num'), //票数
                    $total_price = $('#total_price'); //票价总额
				
                var sc = $('#seat_area').seatCharts({
                    map:text_map,// [//座位结构图 a 代表座位; 下划线 "_" 代表过道
                    naming: {//设置行列等信息
                        top: false, //不显示顶部横坐标（行） 
                        getLabel: function(character, row, column) { //返回座位信息 
                        	
                            return column;
                        }
                    },
                    legend: {//定义图例
                        node: $('#legend'),
                        items: [
                        	['c', 'unavailable', '已预约'],
                            ['c', 'available', '可选座'],
                            ['c', 'selected', '已选择']
                        ]
                    },
                    click: function() {

                        if (this.status() == 'available' ) { //若为可选座状态，添加座位
                            $('<li>' + (this.settings.row + 1) + '_' + this.settings.label + '</li>')
                                    .attr('id', 'cart-item-' + this.settings.id)
                                    .data('seatId', this.settings.id)
                                    .appendTo($cart);
                            $tickects_num.text(sc.find('selected').length + 1); //统计选票数量
                            $total_price.text(getTotalPrice(sc) + price);//计算票价总金额
                            return 'selected';
                        } else if (this.status() == 'selected') { //若为选中状态
                            $tickects_num.text(sc.find('selected').length - 1);//更新票数量
                            $total_price.text(getTotalPrice(sc) - price);//更新票价总金额
                           
                            $('#cart-item-' + this.settings.id).remove();//删除已预订座位
                            return 'available';
                        } else if (this.status() == 'unavailable') { //若为已售出状态
                            return 'unavailable';
                        } else {
                            return this.style();
                        }
                    }
                });
                
         
                //设置已售出的座位
                //console.log(unavaliable.length);
                for(var t=0;t<unavaliable.length;t++){
                	sc.get([unavaliable[t]]).status('unavailable');
                	
                }
                
                //sc.get(['8_14']).status('unavailable');
                //sc.get(['3_10']).status('unavailable');
            });
			
            function getTotalPrice(sc) { //计算票价总额
                var total = 0;
                sc.find('selected').each(function() {
                    total += price;
					
                });
				//alert(sc['map']);
                return total;
            }
			$('.bookingbtnbug').click(function(){

				 /***********验证信息  start************/
				 var datetimepicker1 = document.getElementById("datetimepicker1").value;
				 var datetimepicker2 = document.getElementById("datetimepicker2").value;
				 if(datetimepicker1!=null & datetimepicker1!=""){
				 }else{
					 //console.log("请选择起始时间");
					 layer.msg('请选择起始时间');
				 }
				 if(datetimepicker2!=null & datetimepicker2!=""){
				 }else{
					 //console.log("请选择结束时间");
					 layer.msg("请选择结束时间");
				 }
				 selects=[];
			     $("#seats_chose").each(function () {
                    $(this).find('li').each(function() {
                      selects.push($(this).text());
                    });
                 });
			     if(selects.length>0){
			     }else{
			    	 //console.log("请选座");
			    	 layer.msg("请选座");
			     }
			     /***********验证信息  end************/
			     
			     
			     var shop_id = document.getElementById("shop_id").value;
                 if(selects.length>0 &  datetimepicker1!=null & datetimepicker2!=null & datetimepicker1!="" & datetimepicker2!=""){
             
                	 $.ajax({
      		            cache: true,
      		            traditional: true,
      		            type: "POST",
      		            url:'/seat/selectseat',
      		            data:{selects:selects,shop_id:shop_id,start:datetimepicker1,end:datetimepicker2,cell:1},
      		            //dataType: 'json',
      		            async: false,
      		            success: function(data) {
      		            	
      		                if(data=="ok"){
      		                    layer.msg('预约成功');
      		                }else{
      		                    layer.msg('预约失败'); 
      		                }
      		                window.location.reload();
      		                $('#openseat').modal('hide');
      		            }
      		        });
                  }
                 
			});
			
        </script>

<div class="clear"></div>
<div id="footer">
  <div class="copyright">
    <div class="Navigation"><a href="#">关于B_Booking</a><a href="#">合作伙伴</a><a href="#">营销中心</a><a href="#">廉正举报</a><a href="#">联系客服</a><a href="#">开放平台</a><a href="#">诚征英才</a><a href="#">联系我们</a><a href="#">网站地图</a><a href="#">法律声明</a></div>
    <div class="copy">Copyright © 2014 MYCLASS.C0M. All Rights Reserved. Designed by:<a href="http://www.wanhu.cn">Wanhu</a><br />
     B_Booking 版权所有 B_Booking经营许可证<br />
    </div>
  </div>
</div>
<!-- ajax获取信息 -->
<script type="text/javascript" th:src="@{/js/customer/shopss.js}"></script>

</body>
</html>
